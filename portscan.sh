#!/bin/bash



# Help
if [ "$1" == "-h" ] || [ "$1" == "--help" ] ; then
  echo "Usage: ./scanner.sh"
  exit
fi

# Version
if [ "$1" == "-v" ] || [ "$1" == "--version" ] ; then
  echo "Port Scanner 9000 v1.0"
  exit
fi

if [ $(id -u) != "0" ]; then
  echo "This script must be run with superuser privileges. Please use 'sudo' to continue."
  exit
fi

clear

# Take in Address and Ports
echo -n "Enter your domain: "
read domain
#domain="www.rit.edu"

echo -n "Enter a starting point between 0 and 1000: "
read start_port
#start_port=79

# Validate Ports
if [ $start_port -lt 0 ] || [ $start_port -gt 1000 ]; then
echo "Invalid starting point. Please enter a number between 0 and 1000."
fi 


echo -n "Enter an ending port between $start_port and 1000: "
read end_port
#end_port=81

if [ $end_port -lt $start_port ] || [ $end_port -gt 1000 ]; then
echo "Invalid ending port. Please enter a number between start and 1000."
fi 

# Scan ports
scan_text=$(sudo nmap -sT -p $start_port-$end_port $domain -oX /tmp/scan_text.xml )

# nmap -sS -p 1-65535 localhost
# if error, inform user
reset="\033[0m"
green="\033[92m"
red="\033[91m"
yellow="\033[93m"
normal="\033[0;39m"

hostname=$(xmllint --xpath "//hostname[@type='user']/@name" /tmp/scan_text.xml | cut -d'"' -f2 | sort -u)

xmllint --xpath "//port" /tmp/scan_text.xml | while read -r line; do
      port=$(echo "$line" | xmllint --xpath "string(//@portid)" -)
      state=$(echo "$line" | xmllint --xpath "string(//state/@state)" -)
      
      if [[ "$state" == "open" ]]; then
        echo -e "$green$hostname Port $port: open$normal"
      fi
      if [[ "$state" == "closed" ]]; then
        echo -e "$red$hostname Port $port: closed$normal"
      fi
      if [[ "$state" == "filtered" ]]; then
        echo -e "$yellow$hostname Port $port: filtered$normal"
      fi
done

rm /tmp/scan_text.xml


exit
